---
title: "Statistics-for-Linguists-2024-01-17-Multilevel-models"
author: "Adam Tallman"
date: "2024-01-16"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lme4)
library(lmerTest)
```

## The data

```{r}
df <- read.csv("/Users/Adan Tallman/Desktop/StatisticsinLinguistics_FSU_2023_2024/07_data/phoneme_inventories.csv", header = TRUE)
```

```{r}
head(df)
```

```{r}
options(scipen = 999)
ggplot(df, aes(x=pop))+
  geom_bar(color="black")+
  stat_bin(bins=50)
```


```{r}
ggplot(df, aes(x=log(pop)))+
  geom_bar(color="black")+
  stat_bin(bins=50)
```


```{r}
ggplot(df, aes(x=inv))+
  geom_bar(color="black")+
  stat_bin(bins=50)
```

```{r}
ggplot(df, aes(x=log(inv)))+
  geom_bar(color="black")+
  stat_bin(bins=50)
```


So let's use variables that are more normally distributed.


```{r}
df$logpop <- log(df$pop)
df$loginv <- log(df$inv)

```



```{r}
plot.ods <- ggplot(df, aes(x=logpop, y=loginv))+
  geom_point()+
  geom_smooth(method = "lm", se =FALSE)
plot.ods
```

```{r}
model.ols1 <- lm(loginv~logpop, data=df) 
summary(model.ols1)
```


## Levels in the data

But there are huge differences across the families in terms of representativeness

```{r}
table(df$family.name)
```
Let's take the largest numbers


```{r}
df.lgsubset <- subset(df, family.name == "Indo-European"|
                        family.name =="Uto-Aztecan"|
                        family.name == "Atlantic-Congo"|
                        family.name == "Sino-Tibetan"|
                        family.name == "Otomanguean"|
                        family.name == "Austronesian"|
                        family.name == "Pama-Nyungan"|
                        family.name == "Austroasiatic"|
                        family.name =="Arawakan"|
                        family.name == "Pano-Tacanan")


```

```{r}
ggplot(df.lgsubset, aes(x=loginv, y=logpop, color=family.name))+
  geom_point()+
  geom_smooth(method="lm", se = FALSE)
```

```{r}
plot1 <- ggplot(df.lgsubset, aes(x=logpop, y=loginv, group=family.name))+
  geom_point()+
  geom_smooth(method="glm",se = FALSE)
plot1 +  facet_wrap(~ family.name, ncol=3)


```

```{r}
df.areasubset <- subset(df, area !="")

plot2 <- ggplot(df.areasubset, aes(x=logpop, y=loginv, group=area))+
  geom_point()+
  geom_smooth(method="glm",se = FALSE)
plot2 +  facet_wrap(~ area, ncol=3)
```


## Multilevel model

One disadvantage of multilevel models is that their complexity makes them hard to interpret.

Its typical to AICs in order to assess multilevel models. These are multilevel models without the predictor variable.


```{r}
mod.lmer.null1 <- lmer(loginv~(1|family.name)+ (1|area), data=df)
mod.lmer.null2 <- lmer(loginv~(1|family.name), data=df)
mod.lmer.null3 <- lmer(loginv~(1|area), data=df)
```

```{r}
anova(mod.lmer.null1,
      mod.lmer.null2,
      mod.lmer.null3)
```
The first null model is the best because  it has the lowest AIC and lowest BIC.


```{r}
mod.lmer.a <- lmer(loginv~logpop+(1|family.name)+(1|area), data=df) #This is the code for a varying intercept model


mod.lmer.ab <- lmer(loginv~logpop+(1+logpop|family.name) +(1+logpop|area),data=df) #This is the code for a varying intercept and slope model

```
```{r}
summary(mod.lmer.a)
```
```{r}
summary(mod.lmer.ab)
```

So the correlation is still weakly statistically significant.

```{r}
anova(mod.lmer.null1, mod.lmer.a, mod.lmer.ab)
```
According to the BIC the null model accounts for the variation better than the models with the predictor variables.

## Coefficients from a multilevel model

There isn't just a single coefficient for a multilevel model

```{r}
beta1 <- coef(mod.lmer.ab)$family.name
colnames(beta1) <- c("Intercept", "Slope")

beta2 <- coef(mod.lmer.ab)$area
colnames(beta2) <- c("Intercept", "Slope")
```

If we plot the coefficients we can see that they follow a normal distribution.

```{r}
library(gridExtra)
p1 <- ggplot(beta1, aes(Slope))+
  geom_density(fill="slategray2", color="slategray2", alpha=0.8)+
  ggtitle("Random slopes by linguistic family")


p2 <- ggplot(beta1, aes(Intercept))+
  geom_density(fill="slategray2", color="slategray2", alpha=0.8)+
  ggtitle("Random intercepts by linguistic family")

p3 <- ggplot(beta2, aes(Slope))+
  geom_density(fill="slategray2", color="slategray2", alpha=0.8)+
  ggtitle("Random slopes by area")

p4 <- ggplot(beta2, aes(Intercept))+
  geom_density(fill="slategray2", color="slategray2", alpha=0.8)+
  ggtitle("Random intercepts by area")

grid.arrange(p1, p2, p3, p4, ncol=2)
```

